<!DOCTYPE html>
<html>
  <head>
    <title>Nipponquest</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= stylesheet_pack_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>

  <body>
    <% if flash[:alert].present? %>
        <%= flash[:alert] %>
    <% end %>
    <div class="background-side">
     <div class="container text-center bg-white border-side">
       <div class="row">

        <% unless controller_name == 'homes' || controller_name == "sessions"|| controller_name == "registrations" || controller_name == "passwords" %>

         <% if admin_signed_in? %>
          <% if request.fullpath.include? "/admin" %>
            <div class="col-lg-3 mx-auto background-color border-side2">
             <div class="sticky-top">
              <%= link_to root_path do %>
                <%= image_tag "NIPPONQUESTロゴ.png", style: 'width: 230px; height: auto;' %>
              <% end %>

              <div class="col mx-auto mt-5 text-center">
               <ul class="list-unstyled d-inline-block">
                 <li class="mb-4 text-left h3"><%= link_to "▷投稿管理", admin_posts_path, class:"text-dark font-weight-bold" %></li>
                 <li class="mb-4 text-left h3"><%= link_to "▷ユーザー管理", admin_users_path, class:"text-dark font-weight-bold" %></li>
                 <li class="mb-4 text-left h3"><%= link_to "▷ログアウト", destroy_admin_session_path, class:"text-dark font-weight-bold", method: :delete %></li>
               </ul>
              </div>
             </div>
            </div>

        <% else %>

         <div class="col-lg-3 mx-auto background-color border-side2">
           <div class="sticky-top">

              <%= link_to posts_top_path do %>
                <%= image_tag "NIPPONQUESTロゴ.png", style: 'width: 230px; height: auto;' %>
              <% end %>

           <div class="current_user_side mt-3">
             <div class="pt-4">
               <%= image_tag current_user.get_profile_image, size: "60x60" , class:"rounded-circle" %>
              </div>
             <h4 class="pt-4">
              <%= link_to user_path(current_user), class:"text-dark font-weight-bold" do %>
                <u><%= current_user.name %></u></br>
              <% end %>
              <%= current_user.account_id %>
             </h4>

             <h4 class="mt-4">訪れた県:<%= current_user.posts.group(:prefecture).count.keys.size %>/47県</h4>
             <h4><%= image_tag "場所.png", size: "30x30" %> <%= current_user.posts.group(:location_genre).count["location"] || 0 %>件
               <%= image_tag "グルメ.png", size: "30x30" %> <%= current_user.posts.group(:location_genre).count["food"] ||0 %>件
             </h4>

             <div>
              <h4>
                <%= link_to user_followings_path(current_user), class:"text-dark font-weight-bold" do %>
                  フォロー<%= current_user.followings.count %>人
                <% end %>
              </h4>
              <h4>
                <%= link_to user_followers_path(current_user), class:"text-dark font-weight-bold" do %>
                  フォロワー<%= current_user.followers.count %>人
                <% end %>
              </h4>
             </div>

              <% if unchecked_notifications.any? %>
                <%= link_to notifications_path(current_user) do %>
                  <%= image_tag "notifications.png" %>
                <% end %>
              <% else %>
                <%= link_to notifications_path(current_user) do %>
                  <%= image_tag "no-notifications.png" %>
                <% end %>
              <% end %>
           </div>

           <div class="col mx-auto mt-5 text-center">
            <ul class="list-unstyled d-inline-block">
             <li class="mb-4 text-left h3"><%= link_to "▷みんなの投稿一覧", posts_path, class:"text-dark font-weight-bold" %></li>
             <li class="mb-4 text-left h3"><%= link_to "▷ユーザーを探す", users_search_path, class:"text-dark font-weight-bold" %></li>
             <li class="mb-4 text-left h3"><%= link_to "▷いいねリスト", posts_favorite_path, class:"text-dark font-weight-bold" %></li>
             <li class="mb-4 text-left h3"><%= link_to "▷ログアウト", destroy_user_session_path, class:"text-dark font-weight-bold", method: :delete %></li>
            </ul>
           </div>

           <div class="pt-5 pb-5">
             <%= link_to new_post_path do %>
               <%= image_tag "新規作成.png" %>
              <% end %>
           </div>

          </div>
         </div>
        <% end %>

        <% elsif user_signed_in?  %>
         <div class="col-lg-3 mx-auto background-color border-side2">
           <div class="sticky-top">

             <%= link_to posts_top_path do %>
               <%= image_tag "NIPPONQUESTロゴ.png", style: 'width: 230px; height: auto;' %>
             <% end %>

             <div class="current_user_side mt-3">
              <div class="pt-4">
               <%= image_tag current_user.get_profile_image, size: "60x60" , class:"rounded-circle" %>
              </div>
              <h4 class="pt-4">
                <%= link_to user_path(current_user), class:"text-dark font-weight-bold" do %>
                  <u><%= current_user.name %></u></br>
                <% end %>
                <%= current_user.account_id %>
              </h4>

              <h4 class="mt-4">訪れた県:<%= current_user.posts.group(:prefecture).count.keys.size %>/47県</h4>
              <h4><%= image_tag "場所.png", size: "30x30" %> <%= current_user.posts.group(:location_genre).count["location"] || 0 %>件
                  <%= image_tag "グルメ.png", size: "30x30" %> <%= current_user.posts.group(:location_genre).count["food"] ||0 %>件</h4>

              <div>
                <h4>
                  <%= link_to user_followings_path(current_user), class:"text-dark font-weight-bold" do %>
                    フォロー<%= current_user.followings.count %>人
                  <% end %>
                </h4>
                <h4>
                  <%= link_to user_followers_path(current_user), class:"text-dark font-weight-bold" do %>
                    フォロワー<%= current_user.followers.count %>人
                  <% end %>
                </h4>
              </div>

              <% if unchecked_notifications.any? %>
                <%= link_to notifications_path(current_user) do %>
                  <%= image_tag "notifications.png" %>
                <% end %>
              <% else %>
                <%= link_to notifications_path(current_user) do %>
                  <%= image_tag "no-notifications.png" %>
                <% end %>
              <% end %>
           </div>

           <div class="col mx-auto mt-5 text-center">
            <ul class="list-unstyled d-inline-block">
             <li class="mb-4 text-left h3"><%= link_to "▷みんなの投稿一覧", posts_path, class:"text-dark font-weight-bold" %></li>
             <li class="mb-4 text-left h3"><%= link_to "▷ユーザーを探す", users_search_path, class:"text-dark font-weight-bold" %></li>
             <li class="mb-4 text-left h3"><%= link_to "▷いいねリスト", posts_favorite_path, class:"text-dark font-weight-bold" %></li>
             <li class="mb-4 text-left h3"><%= link_to "▷ログアウト", destroy_user_session_path, class:"text-dark font-weight-bold", method: :delete %></li>
            </ul>
           </div>

           <div class="pt-5 pb-5">
             <%= link_to new_post_path do %>
               <%= image_tag "新規作成.png" %>
              <% end %>
           </div>

          </div>
         </div>

        <% else %>
        <% end %>

      <% end %>

        <div class="col-lg-9 mx-auto">
          <%= yield %>
        </div>

      </div>
     </div>
    </div>

  </body>

</html>
